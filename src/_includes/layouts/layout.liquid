<!doctype html>
<html lang="en">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta
      name="description"
      content="{{ description | default: 'The Personal Website of Omar Almasry: An Independent UX Engineer' }}"
    >
    <meta name="author" content="Omar Almasry">
    <title>{{ title | default: 'Omar Almasry Portfolio' }}</title>

    <!-- Dynamic Favicon managed via /scripts/dynamic-favicon.js -->
    <script src="/scripts/dynamic-favicon.js" defer></script>
    <link rel="manifest" href="/site.webmanifest">

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="{{ title | default: "Omar Almasry\s Personal Website" }}">
    <meta
      property="og:description"
      content="{{ description | default: 'Showcasing scalable, high-performance websites optimized for enterprises.' }}"
    >
    <meta property="og:image" content="{{ og_image | default: '/images/png/og.png' }}">
    <meta property="og:url" content="{{ page_url | default: 'https://omaralmasry.com' }}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ title | default: "Omar Almasry\'s Portfolio" }}">
    <meta
      name="twitter:description"
      content="{{ description | default: 'Crafting accessible, high-performance websites and digital products. UX Engineer helping brands deliver seamless user experiences.' }}"
    >
    <meta name="twitter:image" content="{{ og_image | default: '/images/png/og.png' }}">

    <!-- Robots Meta -->
    <meta name="robots" content="index, follow">

    <!-- Stylesheet -->
    <link href="/dist/output.css" rel="stylesheet">
    <noscript>
      <style>
        .load_grid {
          display: none !important;
        }
      </style>
    </noscript>
  </head>
  <body>
    <div class="load_grid">
      {% for i in (1..100) %}
        <div class="load_grid-item"></div>
      {% endfor %}
    </div>
    <script>
      (function () {
        const colors = ['#FB8304', '#40BFAE', '#FE3300', '#3d60e2', '#EDF060'];
        const items = document.querySelectorAll('.load_grid-item');
        const storedColors = sessionStorage.getItem('transitionColors');
        const gridSize = 10; // 10x10 grid

        const applyColors = (colorArray) => {
          items.forEach((item, i) => {
            if (colorArray[i]) item.style.backgroundColor = colorArray[i];
          });
        };

        const generateColors = () => {
          const newColors = [];
          items.forEach((item, index) => {
            let color;
            let attempts = 0;
            const maxAttempts = 10;

            do {
              color = colors[Math.floor(Math.random() * colors.length)];
              attempts++;

              const row = Math.floor(index / gridSize);
              const col = index % gridSize;

              const leftIndex = index - 1;
              const hasLeftNeighbor = col > 0 && leftIndex >= 0;
              const leftColor = hasLeftNeighbor ? newColors[leftIndex] : null;

              const topIndex = index - gridSize;
              const hasTopNeighbor = row > 0 && topIndex >= 0;
              const topColor = hasTopNeighbor ? newColors[topIndex] : null;

              if (color !== leftColor && color !== topColor) {
                break;
              }
            } while (attempts < maxAttempts);

            item.style.backgroundColor = color;
            newColors.push(color);
          });

          sessionStorage.setItem('transitionColors', JSON.stringify(newColors));
        };

        if (storedColors) {
          try {
            const colorArray = JSON.parse(storedColors);
            if (Array.isArray(colorArray) && colorArray.length === items.length) {
              applyColors(colorArray);
              return;
            }
          } catch (err) {
            // Ignore invalid stored data and regenerate
          }
        }

        generateColors();
      })();
    </script>
    {% render 'partials/navbar', page: page %}
    <main>
      {{ content }}
    </main>
    {% render 'partials/footer' %}

    <!-- Custom Cursor -->
    <div class="cursor-wrapper">
      <div class="cursor">
        <div class="cursor_dot"></div>
      </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="/scripts/main.js" defer></script>
    <script src="/scripts/cursor.js" defer></script>
    <script src="/scripts/colorful-heading.js" defer></script>
    <script src="/scripts/page-transition.js" defer></script>
    <script src="/scripts/cta-grid-animation.js" defer></script>
  </body>
</html>
